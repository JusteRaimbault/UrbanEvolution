\documentclass[letterpaper]{article}

\usepackage{natbib,alifeconf}  %% The order is important
\usepackage{hyperref}

% *****************
%  Requirements:
% *****************
%
% - All pages sized consistently at 8.5 x 11 inches (US letter size).
% - PDF length <= 8 pages for full papers, <=2 pages for extended
%    abstracts (not including citations).
% - Abstract length <= 250 words.
% - No visible crop marks.
% - Images at no greater than 300 dpi, scaled at 100%.
% - Embedded open type fonts only.
% - All layers flattened.
% - No attachments.
% - All desired links active in the files.

% Note that the PDF file must not exceed 5 MB if it is to be indexed
% by Google Scholar. Additional information about Google Scholar
% can be found here:
% http://www.google.com/intl/en/scholar/inclusion.html.


% If your system does not generate letter format documents by default,
% you can use the following workflow:
% latex example
% bibtex example
% latex example ; latex example
% dvips -o example.ps -t letterSize example.dvi
% ps2pdf example.ps example.pdf


% For pdflatex users:
% The alifeconf style file loads the "graphicx" package, and
% this may lead some users of pdflatex to experience problems.
% These can be fixed by editing the alifeconf.sty file to specify:
% \usepackage[pdftex]{graphicx}
%   instead of
% \usepackage{graphicx}.
% The PDF output generated by pdflatex should match the required
% specifications and obviously the dvips and ps2pdf steps become
% unnecessary.


% Note:  Some laser printers have a serious problem printing TeX
% output. The use of ps type I fonts should avoid this problem.


\title{A model of urban evolution based on innovation diffusion}
\author{Juste Raimbault$^{1,2,3}$\\
\mbox{}\\
$^1$Center for Advanced Spatial Analysis, University College London\\
$^2$UPS CNRS 3611 ISC-PIF\\
$^3$UMR CNRS 8504 G{\'e}ographie-cit{\'e}s\\
juste.raimbault@polytechnique.edu} % email of corresponding author

% For several authors from the same institution use the same number to
% refer to one address.
%
% If the names do not fit well on one line use
%         Author 1, Author 2 ... \\ {\Large\bf Author n} ...\\ ...
%
% If the title and author information do not fit in the area
% allocated, place \setlength\titlebox{<new height>} after the
% \documentclass line where <new height> is 2.25in

% Review 1 
%  evaluation:	
%2: (accept)
%Promising work. For the future, it will be interesting to see how the model can reproduce observed properties of different cities.
%TODO discussion real system

% Review 2
%1: (weak accept)
%This paper presents a model of urban evolution based on innovation diffusion. The paper describes a simple model for systems of cities at the macroscopic level using population growth and innovation diffusion, which is then explored on synthethic city systems.

%The paper is well written and the results promising. It would have been very interesting to see how this would work for a model of a real city - there are an abundance of datasets and models (even cited by the author) that would not have been difficult to integrate.
%TODO apply model to real city (more discussion)

%In addition, it would be very useful to include a discussion on how modeling innovation at a microscopic scale (or in-between, eg at a level of suburbs) changes the results of the simulations.
%TODO discussion on microscopic scale

% Review 3

% 2: (accept)
%A model of urban evolution based on innovation diffusion

%I think you have really interesting ideas in this article particularly the research methodology followed. I found the paper to be very comprehensive with an interesting presentation of findings. The objectives are clear and literature review well done. The supporting theory was put together partly based on empirical preliminary studies carried out however, there are few parameters used that need to be justified adequately. The general concerns are that the paper is too hard to read because of typos and number of assumptions that need to be verified and qualified as stated below.

%Typos:
%1. Evolutionary economics also study regional systems of innovation, how it diffuses and thee potential existence of spatial spillovers (Uyarra, 2010).
% typo - OK
%2. Finally, to existence of subsystems in which evolution can occur is natural through the spatial aspect of the model, ….
% typo - OK
%3. It is however significantly different in the way population are updated deterministically
% typo - OK
%4. Transformation processes are included as mutations, when random innovation appear in cities.
% typo - OK
%5. In our model, cities are characterized by their size in terms of population, and city size evolve following a spatial
%typo - OK
%6. Urban genomes are adapted such that the new innovation as an initial penetration rate ..
%typo - OK
%7. We choose simply to quantify the level of hierarchy at final time, estimated by fitting the rank-size law on populations using an Ordinary Least Squares on logarithms.
% typo - OK
%8. what means that stochastic noise is not an issue for interpreting indicator values … what means that these two last indicators need more statistical precision
% typo - OK
%9. we find that it always increase for larger population
% typo - OK
%10. it means that systems where i nteraction are more global will be less unequal. This is however not always the case in such urban dynamics model as
% typo - OK
%11. For low values of mutation rates, with find a piecewise linear
% typo - OK
%12. This peak is the strongest when innovation diffuse at broader range , what may mean that this regime is due to the emergence of regional ensemble of comparable competitivity and thus a higher chance of high utility innovation,
% typo - OK
%13. cumulated variance on the second and 91% on the third, confirming that even if correlation exist the behavior of
% typo - OK
%14. one may prefer in the compromise the points just before the transition which correspond to a local diffusion setting. Thus, local diffusion correspond to intermediate
%TODO typo
%15. urban genome can be used to simulated urban dynamics
% typo - OK
%16. model to real system …. and evoluting sub-systems
% typo - OK
%Other issues:
%1. You need to deal with text formatting as some texts are being cut out at the end of the line (observed on paragraph 1 on page 5).
%TODO pb cropping fig2 - OK?
%2. Use of compromise and compromize in the same article, (kind of linear compromize between utility … prefer in the compromise the …)
%TODO typo
%3. It is not clear why the growth rate is fixed to 0.005 and the cited paper (Raimbault, 2020c) does not justify the use of that value.
%TODO justify fixed growth rate
%4. Fig 1 is a bit confusing, you will need to find a better way of presenting it than this.To enhance readability, the mutation rate and adoption rate should be clearly associated with those rows and columns you mentioned. As it is, it's hard to read.
%TODO facet names
%5. The statement “This increase however reaches a plateau around half of the width of the world (dG = 0.5) which is more obvious for higher values of mutation rates (bottom raw) …” is also confusing as it is not clear which plotting it refers to as it does not appear to apply to all plottings. I don’t think ‘(bottom raw) ’ is correct either.
%TODO clarify
%Your arguments are strong and I hope my comments will help to fine-tune your article to make it more readable. Good luck with your submission.




\begin{document}
\maketitle

\begin{abstract}
% Abstract length should not exceed 250 words
The dynamics of urban systems can be understood from an evolutionary perspective, in some sense extending biological and cultural evolution. Models for systems of cities implementing elementary evolutionary processes remain however to be investigated. We propose here such a model for urban dynamics at the macroscopic scale, in which the diffusion of innovations between cities captures transformation processes (mutations) and transmission processes (diffusion), using two coupled spatial interaction models. Explorations of the model on synthetic systems of cities show the role of spatial interaction and innovation diffusion ranges on measures of diversity and utility, and the existence of intermediate ranges yielding an optimal utility. Multi-objective optimization shows how the model produces a compromise between utility and diversity. This model paves the way towards more elaborated formalizations of urban evolution.
\end{abstract}

% Urban Systems; Urban Evolution; Innovation Diffusion


\section{Introduction}


% (i) interest to understand urban dynamics, link to ALife

Urban systems are complex as they combine technical artefacts with socio-economic dynamics at multiple temporal and spatial scales. An understanding of processes driving their dynamics is an important aspect for shaping sustainable policies, and a sustainable design and management of cities \citep{lobo2020urban}. Multiple disciplines and viewpoints have proposed such insights from a complexity perspective \citep{pumain2020conclusion}, and Artificial Life approaches have shown promising results to study urban systems, both through conceptual contributions such as interpreting cities through biological metaphors \citep{batty2009centenary}, but also through modeling and simulation for urban growth including cellular automata and evolutionary computation \citep{raimbault2020cities}.


% (ii) Urban Evolution / Cultural evolution

A stream of research tightly linked to ALife relates to concepts of \emph{Urban Evolution}. These build in a sense on Cultural Evolution \citep{mesoudi2001cultural}, which aims at understanding changes in social knowledge as evolutionary processes involving replication, mutation, selection. It bears similarities with biological evolution but is not reducible to it, and for example uses the concept of \emph{meme} as transmission units comparable to genes. Both biological and cultural evolution can be linked into common frameworks and models, implying the coupling of different timescales \citep{bull2000meme}. In terms of urban studies, the concept of urban evolution is less formalized than cultural evolution and can be understood in multiple ways. \cite{votsis2019urban} use the concept of Urban DNA to characterize morphological properties of cities such as population density or the role of the road network. Similarly, \cite{kaya2017urban} describe cities based on their morphological properties as a product of their dynamics. \cite{wu2011urban} link the parameters of a cellular automaton model of urban growth to intrinsic properties of urban regions, which should play a role in their overall evolution. \cite{d2014urban} propose an urban genetic code as the way agents cooperate and compete, cities emerging as dynamical equilibria from these interactions. In Economic Geography, the concept of co-evolution is used mostly for urban agents such as firms and stakeholders \citep{gong2019co}. At the macroscopic scale of urban systems, \cite{pumain2018evolutionary} proposes an evolutionary theory to study systems of cities as complex adaptive systems, in which interactions between cities play a crucial role. Corresponding simulation models were proposed with different thematic focus, for example by \cite{cottineau2015modular} with economic exchanges and by \cite{raimbault2020indirect} with infrastructure networks. In Urban Design, \cite{batty2009digital} introduce evolutionary computation to explore possible urban forms. There still however remains a lack of models which would operationalize the concept of urban evolution in a way close to its biological and cultural counterparts, i.e. capturing explicitly the fundamental processes of transmission and transformation within differentiating subsystems \citep{durham1991coevolution}.


% (iii) Innovation diffusion - in ALife studies ; - in urban systems
%\cite{Eletreby5664} diffusion/evolving

Besides, a central concept bridging ALife and evolution with the study of urban systems is the concept of innovation diffusion. Within artificially evolved systems, understanding how innovation emerges and how it diffuses in the population is essential \citep{bedau2000open}. One aspect of open-ended evolution are mechanisms endogeneously producing novelty. In the case of urban systems, \cite{hagerstrand1968innovation} had already highlighted the role of a hierarchical diffusion of innovation between cities in their trajectories. The aforementioned evolutionary urban theory suggests that innovation cycles and their hierarchical diffusion is a possible explanation for the properties of urban scaling laws \citep{pumain2006evolutionary}. Evolutionary economics also study regional systems of innovation, how it diffuses and the potential existence of spatial spillovers \citep{uyarra2010evolutionary}. At the microscopic scale, several agent-based models of innovation diffusion highlight the role of social and geographical networks, both of which are embedded into urban systems \citep{zhang2019empirically}. Thus, the diffusion of innovation is a privileged entry into urban evolutionary processes.


% (iv) contribution

This paper proposes to tackle the issue of modeling urban evolution by using innovation diffusion processes to capture elementary evolutionary processes. We investigate thus the question to what extent simple models of urban evolution integrating an urban genome can be used to simulate urban dynamics. Our contribution relies on the following points: (i) we describe a relatively simple model for systems of cities at the macroscopic scales, based on population growth and the diffusion of innovation between cities; (ii) we systematically explore this model on synthetic systems of cities to extract stylized facts on different indicators including global diversity and utility.

The rest of this paper is organized as follows: in the next section we give the model context and describe it formally. We then present numerical experiments, including internal statistical validation, exploration of the parameter space, and optimization using a multi-objective genetic algorithm. We finally discuss implications of our results and possible future extensions.



\section{Urban evolution model}

\subsection{Rationale}

The core idea of the model is to build on a concept of ``Urban DNA'' which would capture evolution processes as in biological evolution and cultural evolution, i.e. a kind of genome that cities would be exchanging and which would undergo mutation processes. A suitable candidate is to build on the concept of \emph{meme} introduced in the field of cultural evolution. However, several particularities must be stressed out when working with urban systems. First, they are multi-dimensional implying very different types of agents, including physical and technical artefacts (e.g. infrastructures) but also social and economical structures. A comprehensive urban genome would include these very different dimensions. Then, they are multi-scalar in time and space, meaning that evolution processes, if they exist, may occur at different paces and through different elementary carriers. Finally, they are embedded in the geographical space, what structures the way transmission and mutation can occur, but also can strongly change properties of underlying processes \citep{raimbault2019space}. We choose to focus on the last point, considering a model at the macroscopic scale where cities are agents and with a one-dimensional genome, but in which spatial interactions are crucial for the dynamics. More particularly, this model combines two spatial interaction models \citep{fotheringham1989spatial}.


Several models have been proposed to simulate the diffusion of innovation at microscopic and mesoscopic scales \citep{kiesling2012agent}. \cite{blommestein1987adoption} describe a model of innovation diffusion and urban dynamics with endogenous demand for innovations, but in which the spatial component only influences prices of innovations. \cite{deffuant2005individual} give an example of an elaborated model for adoption dynamics at the microscopic level. Effective channels for the diffusion of innovations are multiple, and can for example be urban firm linkages \citep{rozenblat2007firm}. \cite{pumain2017simpoplocal} describe a model based on innovation diffusion to explain the emergence of the first cities. \cite{favaro2011gibrat} study an urban growth model including innovation diffusion at the scale of the urban system. Our model builds on this last framework, extending and adapting it to an urban evolution context. We keep the innovation diffusion and spatial interaction processes unchanged, but take a deterministic update of populations. The introduction of new innovations is modified to better fit the urban evolution context. Finally, the introduction of indicators to quantify model behavior regarding different dimensions is a significant extension to the initial model.

In our model, cities are characterized by their size in terms of population. City sizes evolve following a spatial interaction model taking into account the attractivity of cities. This attractivity is determined by how innovative cities are. Transformation processes are included as mutations, when random innovations appear in cities. Transmission processes (spatial crossover) are included by diffusing innovations between cities. Finally, the existence of subsystems in which evolution can occur comes naturally with the spatial aspect of the model: different regions in space may behave and evolve differently, possibly resulting in the emergence of co-evolution niches \citep{holland2012signals,raimbault2018co}.

\subsection{Model description}


% - urban genome as a matrix (one for each city)
% - rows: % of each innovation (to simplify, sums to 1), columns: dimension of "urban life": transportation, economic production, leisure, built environment, governance, etc.
% - mutations: new innovations: new row. "endogenous innovation": add new column (dimension that did not exist before: new info technologies, induce niches, new needs, new dimensions in themselves. too complicated, do not include this aspect for the sake of simplicity, consider "fundamental dimensions" only
% - interdependance between dimensions? -> should yield "technological lockdowns". Q: how to implement? SBM? additional correlation matrix/ parameter?
% - innovation utility matrix: stochastic, not necessarily strongly increasing (should be similar though)
% - crossovers is hierarchical spatial diffusion: spatial interaction model
% - ! no network evolving (too complicated
% - evolves pop following Favaro-Pumain. P(innov) = scaling (pop) / utility ? ! not pop, gdp? (ok for eco innovation and sectors - should be multi-dimensional indeed)
 
We now formally describe the urban evolution model. A number $N$ of cities are located in the geographical space, and described in time by their size $P_i (t)$ (which generally corresponds to population). The geography is captured with a distance matrix $d_{ij}$ between cities. We consider a one-dimensional technological space in which innovations can be introduced, indexed by their order of apparition $c$. Cities are then also characterized by their innovation profile $\delta_{c,i} (t) \in \left[0;1\right]$ which represents the proportion of population having adopted innovation $c$ in the city $i$ at time $t$. We assume exclusivity in the adoption of innovation, i.e. that we always have $\sum_c \delta_{c,i} (t) = 1$. This innovation profile corresponds to the urban genome. Each innovation has furthermore a utility $u_c >0$ which will influence its diffusion dynamics.


\paragraph{Model dynamics}

% $\rightarrow$ Work under Gibrat independence assumptions, i.e. $\Covb{P_i(t)}{P_j(t)}=0$. If $\vec{P}(t+1)=\mathbf{R}\cdot \vec{P}(t)$ where $\mathbf{R}$ is also independent, then $\Eb{\vec{P}(t+1)}=\Eb{\mathbf{R}}\cdot\Eb{\vec{P}}(t)$. Consider expectancies only (higher moments computable similarly)
%$\rightarrow$ With $\vec{\mu}(t)=\Eb{\vec{P}(t)}$, we generalize this approach by taking $\vec{\mu}(t+1)=f(\vec{\mu}(t))$
%Let $\vec{\mu}(t)=\Eb{\vec{P}(t)}$ cities population and $(d_{ij})$ distance matrix
%Model specified by
%\[
%f(\vec{\mu}) = r_0\cdot \mathbf{Id}\cdot \vec{\mu} + \mathbf{G}\cdot \mathbf{1}
%\]

Starting from an initial configuration, the simulation model is iterated in time with the following steps at each time tick:


\begin{enumerate}
	\item The crossover between urban genomes relies on spatial processes of innovation diffusion. This means that existing innovations are propagated between cities following a spatial interaction model given by

\begin{equation}
\delta_{c,i,t} = \frac{\sum_j p_{c,j,t-1}^{\frac{1}{u_c}} \cdot \exp{(-\frac{d_{ij}}{d_I})}}{\sum_c \sum_j p_{c,j,t-1}^{\frac{1}{u_c}} \cdot \exp{(-\frac{d_{ij}}{d_I})}}
\end{equation}

where $p_{c,i,t} = \delta_{c,i,t} \cdot \frac{P_{i}(t)}{\sum_k P_k (t)}$ is the share of total population adopting $c$ in the city $i$ at time $t$; $d_I$ is the characteristic distance in the spatial innovation model, for which an increase will correspond to a broader spatial diffusion. As the population share is between 0 and 1, higher utilities will effectively diffuse faster as the exponent $1/u_c$ is used. In other terms, the inverse of the utility is the coefficient of population in the underlying spatial interaction model, and using an exponent is more relevant in that sense.


	\item The sizes of cities evolve according to their performance in terms of innovation, i.e. more innovative cities are more attractive. This stage is also deterministic, following  with $P_i(t) - P_i(t-1) = w_I\cdot \sum_j \frac{V_{ij}}{<V_{ij}>}$ where $w_I$ is a fixed growth rate fixed to $w_I = 0.005$ in experiments, and where the interaction potential is defined by
\begin{equation}
V_{ij}= \frac{P_{i}(t-1) \cdot P_{j}(t-1)}{(\sum_k P_k(t-1))^2} \cdot \exp{\left(-\frac{d_{ij}}{d_G} \cdot \prod_c \delta_{c,i,t}^{\phi_{c,t}}\right)}
\end{equation}
where $\phi_{c,t} = \sum_i \delta_{i,c,t}\cdot P_i(t-1) /\sum_{i,c} \delta_{i,c,t}\cdot P_{i}(t-1)$ is the macroscopic adoption level (globally more adopted innovations will have a higher attractivity); $d_G$ is the characteristic distance for this second spatial interaction model. This model for population dynamics was proposed in such a setting by \citep{raimbault2020indirect} without the additional innovation attractivity term.

 \item Finally, mutations in the urban genome (transformation process) corresponds to the introduction of new innovations. Each city has an innovation activity $\beta$ independent of its size, which corresponds to an intrinsic mutation rate; and will have a probability to innovate function of its size, similar to a Gibrat model \citep{pumain2012theorie}, as $\beta \cdot \left(P_i (t) / \max_k P_k (t)\right)^{\alpha_I}$ where $\alpha_I$ is a hierarchy exponent biasing the innovation towards larger cities. The utility for a new innovation is drawn stochastically, following either a normal or log-normal distribution, such that (i) its average corresponds to the current mean of utilities for existing innovations, and (ii) its standard deviation is a fixed parameter $\sigma_U$, which allows controlling the ``disruptivity'' of innovations. Urban genomes are modified such that the new innovation has an initial penetration rate $r_0$ in the innovative city (previous innovation shares are rescaled for this city).
\end{enumerate}

The urban evolution is stopped after a fixed number of steps $t_f$.

\paragraph{Synthetic setup}

Although \cite{raimbault:halshs-01880492} proposed to apply the model of \cite{favaro2011gibrat} on real systems of cities, we focus our model study here on synthetic systems of cities, in order to isolate intrinsic effects independently of geographical contingencies. Cities are located randomly in an uniform square space. City sizes follow a Zipf law with exponent $\alpha_0 = 1$, i.e. such that $P_i (0) = \frac{P_{max}}{i^{\alpha_0}}$ \citep{pumain2012theorie}. We do not modify this initial hierarchy in our experiments. Distances between cities $d_{ij}$ are computed as euclidian distances. We take $N=30$ cities, $P_{max} = 10^5$ and $t_f = 50$ in our experiments, corresponding to a regional or small national system of cities, on timescales of the order of a century.


\paragraph{Indicators}

% - Indicators: innovation diversity (on cities profiles); overall utility (optimal config as a function of lambda - non trivial?) - with path-dep/correlations?; existence of cycles?
%.   compute utility for one city: along each dimension, weight utility of innovations. then aggregate? ~

The behavior of the model is quantified through indicators at the macroscopic scale. These should allow extracting stylized facts from the model exploration. We consider the following indicators:
\begin{itemize}
	\item Average diversity, defined as an Herfindhal diversity index over innovation shares across cities, averaged in time as
	\begin{equation}
		D = \frac{1}{t_f + 1} \sum_{t=0}^{t_f} \left(1 - \sum_{i,c} \left(p_{c,i,t}\right)^2 \right)	
	\end{equation}
	Note that other diversity indices could be applied, or a similar be computed on macroscopic adoption shares or within each city, and would yield different results. This one has the advantage to combine the diversity within and across cities.
	\item Average utility, given by the weighted average of innovation utilities, averaged in time, as
	\begin{equation}
		U = \frac{1}{t_f + 1} \sum_{t=0}^{t_f} \sum_{i,c} \delta_{c,i,t} u_c 
	\end{equation}
	\item Innovativity, given by the average number of innovations per city and unit of time $I = \frac{\max c}{N\cdot (t_f + 1)}$.
	\item To quantify the trajectories of city populations, many indicators can be used \citep{raimbault2020unveiling}. We choose to simply quantify the level of hierarchy of final populations. It is estimated by adjusting a rank-size law for populations, using an Ordinary Least Squares regression on logarithms of populations as a function of logarithms of ranks. This captures if the urban systems has become more unequal in terms of population balance, since the initial hierarchy is fixed.
\end{itemize}


%%%%%%%%%%%%
\begin{figure*}[t]
	\centering
	\includegraphics[width=0.49\linewidth]{figures/averageDiversity-gravityDecay_color-innovationDecay_facet-mutationRate-earlyAdoptersRate_newInnovationHierarchy1_distriblog-normal.png}	\includegraphics[width=0.49\linewidth]{figures/averageInnovation-gravityDecay_color-innovationDecay_facet-mutationRate-earlyAdoptersRate_newInnovationHierarchy1_distriblog-normal.png}	\includegraphics[width=0.49\linewidth]{figures/averageUtility-gravityDecay_color-innovationDecay_facet-mutationRate-earlyAdoptersRate_newInnovationHierarchy1_distriblog-normal.png}	\includegraphics[width=0.49\linewidth]{figures/finalHierarchy-gravityDecay_color-innovationDecay_facet-mutationRate-earlyAdoptersRate_newInnovationHierarchy1_distriblog-normal.png}
	\caption{Values of indicators obtained with the grid model exploration. Each plot give each indicator among diversity $D$, utility $U$, innovation $I$ and population hierarchy $\alpha_P$, at fixed parameters $\alpha_I = 1$, $\sigma_U = 1$ and for the log-normal utility law. Indicators are plotted as a function of gravity interaction range $d_G$, for varying values of innovation diffusion range $d_I$ (color). Sub-panels show varying values of mutation rate $\beta$ (rows) and of early adoption rate $r_0$ (columns).\label{fig:exploration}}
\end{figure*}
%%%%%%%%%%%%


\paragraph{Model parameters}

Parameter explored in experiments are the spatial interaction parameters $d_G,d_I \in \left[0;2\right]$ which correspond to the crossover mechanism; and the innovation parameters which correspond to the mutation mechanism: innovation rate $\beta \in \left[0;1\right]$, innovation hierarchy $\alpha_I \in \left[0;2\right]$, innovation utility standard deviation $\sigma_U \in \left[ 0.7;2\right]$ (the lower bound is a constraint for the existence of the log-normal with log mean 0), initial penetration rate $r_0 \in \left[0.1;0.9\right]$, and type of innovation utility as normal or log-normal. All model parameters are summarized in Table~\ref{tab:params}, with their range, default value and associated process.


%%%%%%%%%%%%
\begin{table}
\caption{Summary of model parameters. We first describe synthetic setup parameters which are fixed during our experiments, and then parameters varied during experiments. We give associated process, indicative range and default value for each parameter.\label{tab:params}}
	\hspace{-0.5cm}
	\footnotesize
	\begin{tabular}{|l|l|l|l|l|l|}
	\hline
	Parameter & Not. & Process & Range & Def. \\ \hline
	Number of cities & $N$ & Spatial scale & $[10 ; 100]$ & $30$\\
	Initial hierarchy & $\alpha_0$ & System of cities & $[0.5 ; 2.0]$ & $1$\\
	Initial population & $P_{max}$ & System of cities & $[10^4 ; 10^7]$ & $10^5$\\
	Simulation steps & $t_f$ & Temporal scale & $[10 ; 100]$ & $50$\\\hline
	Gravity range & $d_G$ & Crossover & $[0 ; 2]$ & $1$\\
	Innovation range & $d_I$ & Crossover & $[0 ; 2]$ & $1$\\
	Innovation rate & $\beta$ & Mutation & $[0 ; 1]$ & $0.5$\\
	Innovation hierarchy & $\alpha_I$ & Mutation & $[0 ; 2]$ & $1$\\
	Innov. utility std. & $\sigma_U$ & Mutation & $\left[ 0.7;2\right]$ & $1$\\
	Penetration rate & $r_0$ & Mutation & $\left[0.1;0.9\right]$ & $0.5$\\
	Utility type & - & Mutation & \{n;ln\}& ln \\
	\hline
	\end{tabular}
\end{table}
%%%%%%%%%%%%



\section{Results}

The model is implemented in \texttt{scala} and integrated into the OpenMOLE software \citep{reuillon2013openmole} for numerical experiments. OpenMOLE allows embedding models in any language as black boxes, provides a transparent access to high performance computing infrastructures, and model exploration and validation methods such as sensitivity analysis, design of experiments, and calibration methods. Experiments are designed through workflows using a Domain Specific Language \citep{passerat2017reproducible}.

Source code of the model and analysis, and results are available on the open git repository of the project at \url{https://github.com/JusteRaimbault/UrbanEvolution}. Simulation data files are available on the dataverse repository at \url{https://doi.org/10.7910/DVN/Q5GKZ0}.

\subsection{Internal validation}

% summary(reldistance("meanAverageDiversity","sdAverageDiversity"))
%   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
% 0.0000  0.6035  1.2685  1.4709  2.1557  6.1199 
%> summary(reldistance("medianAverageDiversity","sdAverageDiversity"))
%   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
% 0.0000  0.5733  1.2115  1.4425  2.0941  6.5835 
% summary(reldistance("meanAverageInnovation","sdAverageInnovation"))
%   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
%  0.000   1.839   4.136   4.768   7.011  15.799 
%> summary(reldistance("medianAverageInnovation","sdAverageInnovation"))
%   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
%  0.000   1.841   4.176   4.783   7.100  15.891 
%summary(reldistance("meanAverageUtility","sdAverageUtility"))
%   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
%  0.000   0.509   1.103   1.320   1.923   6.350 
%> summary(reldistance("medianAverageUtility","sdAverageUtility"))
%   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
% 0.0000  0.4942  1.0857  1.3013  1.8863  6.3479 
%summary(reldistance("meanFinalHierarchy","sdFinalHierarchy"))
%   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
%  0.000   2.488   6.066  11.424  14.133  96.805 
%> summary(reldistance("medianFinalHierarchy","sdFinalHierarchy"))
%   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
%  0.000   2.508   6.074  11.449  14.171  96.789 
% idea: on this "relative dist": index similar to Saltelli to tell distinguishability across the all parameter space?

As the model is stochastic through the mutation process, first experiments are needed to assess the ``internal validity'' of the model, i.e. to what extent studied indicators are robust to noise and how much stochastic repetitions are needed to significantly distinguish between central values of distributions for different parameter points. We sample thus 100 parameter points using a Latin Hypercube Sampling, and run 1000 model repetitions for each point, in order to estimate the statistical properties across different points in the parameter space.

The Sharpe ratios estimated on repetitions as sample standard deviation relative to absolute sample mean have high values for all indicators (min. 3.9 and median 12.1 for diversity; min. 3.0 and median 6.2 for innovation; min. 1.7 and median 3.6 for utility; min. 26 and median 257.3 for population hierarchy). This implies that stochastic noise is not an issue for interpreting indicator values.

We also study the distance between points averages relative to their standard deviation, in order to know the significance in comparing averages. This distance is defined by $\Delta_{ij} = 2\frac{\left|\mu_i - \mu_j \right|}{\sigma_i + \sigma_j}$ if $\mu_i$ are estimated central values (mean or median) and $\sigma_i$ estimated standard deviations. These distances have an average and median larger than one for all couples, and a first quartile larger than one for innovation and population hierarchy, while the first quartile is 0.5 for utility and 0.6 for diversity. The most constraining indicators in terms of statistical precision are thus utility and diversity. 
As in the case of normal distributions, a 95\% confidence interval of size $\sigma_2$ is achieved for $n\simeq 64$ runs, a number of 50 runs is satisfying for further experiments. %TODO new number of runs


\subsection{Model exploration}

We then explore a grid of the parameter space consisting of 23,168 parameter points, with a finer step on spatial parameters $d_G$ and $d_I$, and with 50 model replications for each parameter point. We find that the type of distribution for utility has small effects for all indicators and across most parameter values, but particular cases are more interesting in the log-normal case, which we comment further. Similarly, the effect of innovation hierarchy $\alpha_I$ and of innovation utility standard deviation $\sigma_U$ do not induce strong qualitative differences, so we discuss model behavior obtained at $\alpha_I = 1$ and $\sigma_U = 1$.

The Fig.~\ref{fig:exploration} shows the behavior of indicators with remaining parameters varying, namely spatial interaction parameters $d_G$ and $d_I$, mutation rate $\beta$ and innovation adoption $r_0$. Regarding the behavior of diversity (top left panel of Fig.~\ref{fig:exploration}), we find that it always increases for larger population growth spatial interaction distances, meaning that broader population exchanges will induce a higher diversity in innovations, probably through the higher innovation dynamics induced. This increase however reaches a plateau around half of the width of the world ($d_G = 0.5$) which is more obvious for higher values of mutation rates (bottom raw): higher intrinsic innovation dampens the role of spatial interactions. An increase of innovation interaction distance $d_I$ on the contrary monotonously decreases diversity, consistently with the idea of local innovation niches which can be overridden by competing innovations of higher utility coming from further away. Finally, mutation rate has a strong quantitative impact on total diversity as expected, while higher early adoption rate will change diversity behavior only when mutation rates are also high.

Two indicators which behavior is less rich are innovation and population hierarchy (top right and bottom right panels of Fig.~\ref{fig:exploration}), which could be expected as population dynamics are deterministic and strongly related to space, while innovation is directly related to population. We find that these increase both with $d_G$ and $d_I$, meaning that more interactions and more diffusion will foster local innovation. Regarding the final distribution of populations, this implies that systems where interactions are more global will be less unequal. This is however not always the case in such urban dynamics model as explored by \cite{raimbault2020hierarchy}. The mutation rate $\beta$ here only fosters the role of small $d_I$, yielding higher hierarchies and less innovations for these. The effect of initial adoption rate is small for these indicators. Note that although they appear highly correlated in this region of the parameter space, they are not the indicators with the highest correlation as shown further (see Fig.~\ref{fig:cormat} for a correlation matrix between indicators).

Finally, the indicator with a more interesting behavior is the utility (bottom left panel of Fig.~\ref{fig:exploration}). For low values of mutation rates, we find a piecewise linear behavior as a function of $d_G$ and small effects of $d_I$, meaning that low innovation settings yield regimes where broader interactions are systematically desirable for the all system. However, when $\beta$ is higher, we witness a maximum of utility as a function of $d_G$, consistent across different values of $d_I$ and of $r_0$. This corresponds to an intermediate regional regime where local innovation regimes are more beneficial than a global integration. This peak is the strongest when innovations diffuse at a broader range, which could be consistent with this regime being due to the emergence of regional ensembles of comparable competitivity. Such a setting would yield a higher chance of introducing innovations with a high utility, while a globalized system would concentrate on a single dominating city and be overall less performant.


% correlations

% summary(prcomp(m))
%Importance of components:
%                          PC1    PC2    PC3     PC4
%Standard deviation     0.2925 0.2259 0.1560 0.11976
%Proportion of Variance 0.4882 0.2910 0.1389 0.08183
%Cumulative Proportion  0.4882 0.7793 0.9182 1.00000

We also compute the correlation matrix between indicators across the full grid experiment. This shows that correlations that one could visually extrapolate from studying a part of the parameter space as commented in Fig.~\ref{fig:exploration} do not correspond to the actual correlations on the broader parameter space. Note that local correlation matrices could be estimated for a more thorough discussion. We show the correlation matrix in Fig.~\ref{fig:cormat}. Confidence intervals estimated with the Fisher method are of negligible width compared to correlation values. We find that diversity is finally the indicator with highest correlations. The correlation between innovation and population is low, meaning that the similar curves observed before are a particular case. Innovation and utility have a correlation lower than 0.5, and are thus rather independent. Regarding the effective dimension of the indicator space, a principal component analysis on normalized indicators gives 48\% of variance on the first component, 77\% of cumulated variance on the second and 91\% on the third. This confirms that even if correlations exist, the behavior of indicators are rather independent.

%%%%%%%%%%%%
\begin{figure}[t]
	\centering
	\includegraphics[width=\linewidth,trim={6cm 6cm 0 6cm}]{figures/corrmat_indics.png}
	\caption{Correlation matrix between indicators, estimated on the full grid experiment. Confidence intervals for correlations estimated with the Fisher method are tiny and not distinguishable in the plot.\label{fig:cormat}}
\end{figure}
%%%%%%%%%%%%


\subsection{Model optimization}

%%%%%%%%%%%%
\begin{figure}[t]
	\centering
	\includegraphics[width=\linewidth]{figures/paretoDiversity-Utility_colorinnovationDecay.png}
	\caption{Pareto front for the contradictory indicator of utility and diversity obtained with the NSGA2 algorithm. Point color gives innovation interaction range $d_I$ while point size gives the number of stochastic samples.\label{fig:pareto}}
\end{figure}
%%%%%%%%%%%%

The last experiment we perform is the application of a multi-objective optimization procedure to the model. More particularly, one could want to optimize simultaneously the global utility but also the diversity to ensure a certain resilience in the urban system. We apply thus a bi-objective genetic algorithm on the model, trying to maximize simultaneously utility and diversity. The algorithm is the NSGA2 algorithm \citep{deb2002fast}, which we run for 10,000 generations with a population of 200 individuals on a Island distribution scheme. The algorithm is integrated into the OpenMOLE software, and the stochastic aspect is internally tackled by using an embedding strategy, i.e. by adding the number of repetitions as an additional objective to find compromise points between the number of run needed and their statistical accuracy.

We show in Fig.~\ref{fig:pareto} the obtained points, which are close to a Pareto front. We find two regimes, the first corresponding to the upper points in the plot for higher utilities but lower diversities, which should correspond to the intermediate optimal regimes identified before, and in which some kind of linear compromize between utility and diversity exists: increasing global utility is done at the cost of reducing diversity. Within this first regime, two very different parameter setting coexist, one with high innovation diffusion (light blue, points with higher utility), the other in dark blue with a more local innovation diffusion. This means that reducing the span of innovation diffusion will increase diversity as one could expect. A second part of the Pareto front, obtained after a sharp transition, allows increasing the diversity but at the price of a much lower utility (points on the bottom right). These points are all close to equivalent, and one may prefer in the compromise the points just before the transition which correspond to a local diffusion setting. Thus, local diffusion correspond to intermediate compromises, while broad diffusion corresponds to extremes in the Pareto front. In a nutshell, this optimization exercise is interesting both to show how the model produces compromises, but also how it could be used in practice for innovation policies applied to systems of cities.



\section{Discussion}

Our simple formulation of an urban genome and associated evolutionary processes, implemented by the diffusion of innovation, already capture complex urban dynamics, as shown for example by the emergence of an intermediate optimal regime corresponding to local innovation niches which diffuse far. Although much more empirical work would be needed to compare these stylized facts to real world settings, our model suggests in this particular setting that too much integration is not always optimal, what corresponds to the theoretical fact that complex systems are generally modular at different scales \citep{ethiraj2004modularity}. More generally, regarding the implications of our results for possible formalizations and theories of urban evolution which would closely build on biological and cultural evolution by extending them, we have demonstrated how a particular instance of an urban genome can be used to simulate urban dynamics, including fundamental processes needed to effectively have evolution. To what extent this approach relates to existing approaches of urban evolution which use other definitions remains to be investigated.

Several extensions and applications would be possible to this first model exploration. First, the innovation space in our model remained unidimensional. \citep{hidalgo2007product} show in terms of industrial production by countries that these industrial spaces are highly dimensional in terms of product produced and interdependencies between countries and types of production, increasing the path-dependency in economic trajectories. The investigation of patent data from a semantic viewpoint also shows the highly dimensional nature of technological innovation \citep{bergeaud2017classifying}. A direct extension of our model would consist in having a matrix genome instead of a vector one. Innovations would occur across several dimensions which can correspond to industrial or technological domains, but also social and cultural innovation and innovations in terms of infrastructures which condition the way systems of cities evolve. Each dimension should have particular innovation rules depending on its nature, and dependencies across dimensions could be introduced, implementing the possible emergence of technological co-evolution niches beside the spatial co-evolution niches.

Second, applying the model to real systems of cities, both in terms of initial parametrization and of empirical laws for innovation processes, would allow bringing this approach closer to possible policy applications. \cite{raimbault:halshs-01880492} and later \cite{2020arXiv200510007R} benchmarked several models of urban growth based on interactions between cities, and integrated the model of \cite{favaro2011gibrat} on which this work was based. It however only included accurate initial populations and distance matrix, but no empirical data on innovation waves which were also synthetically constructed. One important aspect of this application to real systems of cities is thus a test of the performance of this model in predicting possible trajectories for systems of cities.

Finally, our approach was rather restricted in the sense that even a broad geographical range is taken into account, a single ontological scale is included in the model, i.e. the macroscopic scale since cities are the basic agents. 
One can expect processes of innovation diffusion to behave differently at the microscopic scale or at intermediate scales of companies or innovation clusters % lit spillovers?
Similarly, a single temporal scale was included, although two dynamics of spatial interaction and innovation diffusion are effectively combined. A multi-scale approach of urban evolution would be necessary to fully account for the complexity of these systems. \cite{raimbault:halshs-02351722} introduced a multi-scalar model for population growth with upward and downward strong feedbacks between the mesoscopic scale (urban form) and the macroscopic scale (spatial interaction model). Adapting this approach in the case of urban evolution through innovation diffusion would be an interesting potential development.
The aspects to be clarified


\section{Conclusion}

We have introduced a simple model of urban evolution integrating effectively the evolutionary processes of transmission, transformation and evolving sub-systems, through innovation diffusion and spatial interactions. Model exploration yield complex behavior while multi-objective optimization shows the potentiality for the model to produce compromises between utility and diversity in the system of cities. This work is thus a first step towards more elaborated models of urban evolution.


\bigskip

\section{Acknowledgements}

Results obtained in this paper were computed on the vo.complex-system.eu virtual organization of the European Grid Infrastructure ( http://www.egi.eu ). We thank the European Grid Infrastructure and its supporting National Grid Initiatives (France-Grilles in particular) for providing the technical support and infrastructure. This work was funded by the Urban Dynamics Lab grant EPSRC EP/M023583/1.

\bigskip

\footnotesize
\bibliographystyle{apalike}
\bibliography{biblio} % replace by the name of your .bib file


\end{document}



%\begin{figure}[t]
%\begin{center}
%\includegraphics[width=2.1in,angle=-90]{fig1.eps}
%\caption{``Energies'' (inferiorities) of strings in a first-order
%  phase transition with latent heat $\Delta\epsilon$.}
%\label{fig1}
%\end{center}
%\end{figure}


%
%\begin{table}[h]
%\center{
%\begin{tabular}{|c|c|c|c|}\hline
%Name & Result & Bonus $b_i$ & Difficulty\\ \hline\hline
%Echo & I/O   & 1 & --\\
%Not  & $\neg A$ & 2 & 1 \\
%Nand & $\neg(A\wedge B)$ & 2 & 1 \\
%Not Or & $\neg A \vee B$ & 3 & 2 \\
%And  &  $ A \wedge B $   & 3 & 2 \\
%Or   &  $ A \vee B $     & 4 & 3 \\
%And Not & $A\wedge\neg B$& 4 & 3 \\
%Nor  & $\neg(A\vee B)$   & 5 & 4 \\
%Xor  & $ A\ {\rm xor}\ B$ &   6 & 4 \\
%Equals &$\neg(A\ {\rm xor}\ B)$&6& 4 \\ \hline
%\end{tabular}
%}
%\vskip 0.25cm
%\caption{Logical calculations on random inputs $A$ and $B$ rewarded,
%bonuses, and difficulty (in minimum number of {\tt nand} instructions
%required). Bonuses $b_i$ increase the speed of a CPU by a factor
%$\nu_i=1+2^{b_i-3}$.}
%\end{table}
%


